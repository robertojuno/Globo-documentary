<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Globo Video con Miniature e Confini Fluorescenti</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    #globeViz { width: 100vw; height: 100vh; }
    .label {
      border-radius: 4px;
      overflow: hidden;
      width: 120px;
      height: 90px;
      box-shadow: 0 0 8px rgba(255,255,255,0.5);
      cursor: pointer;
      pointer-events: auto;
    }
    .label img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    #footer {
      position: fixed;
      bottom: 20px;
      width: 100%;
      text-align: center;
      font-weight: bold;
      font-size: 24px;
      color: white;
      font-family: Arial, sans-serif;
      pointer-events: none;
    }
  </style>
  <script src="https://unpkg.com/globe.gl"></script>
</head>
<body>
  <div id="globeViz"></div>
  <div id="footer">JUNO</div>

  <script>
    const data = [
      { lat: 43.8562586, lng: 18.41330763, videoId: 'GqQKJHXoUD8' },
      { lat: 28.0026, lng: 86.8528, videoId: 'q7_jPoJM-Jc' }
    ];

    const globe = Globe()(document.getElementById('globeViz'))
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-day.jpg')
      .bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png')
      .showAtmosphere(true)
      .pointOfView({ lat: 20, lng: 0, altitude: 2 })
      .htmlElementsData(data)
      .htmlElement(d => {
        const el = document.createElement('div');
        el.className = 'label';
        el.innerHTML = `<img src="https://img.youtube.com/vi/${d.videoId}/hqdefault.jpg" alt="Video Thumbnail">`;
        el.style.pointerEvents = 'auto';
        el.addEventListener('click', e => {
          e.stopPropagation();
          window.open(`https://youtu.be/${d.videoId}`, '_blank', 'noopener,noreferrer');
        });
        return el;
      });

    // Rotazione lenta e continua
    (function rotate() {
      globe.controls().autoRotate = true;
      globe.controls().autoRotateSpeed = 0.3;
      globe.controls().update();
      requestAnimationFrame(rotate);
    })();

    // Carica e mostra confini mondo con effetto fluo
    fetch('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json').then(res => res.json()).then(topology => {
      const countries = topojson.feature(topology, topology.objects.countries).features;

      globe
        .polygonsData(countries)
        .polygonAltitude(0.01)
        .polygonCapColor(() => 'rgba(0,255,255,0.1)')
        .polygonSideColor(() => 'rgba(0,255,255,0.0)')
        .polygonStrokeColor(() => '#0ff')
        .polygonLabel(({ properties: d }) => `<b>${d.ADMIN}</b>`)
        .onPolygonHover((hoverD) => {
          globe
            .polygonAltitude(d => d === hoverD ? 0.03 : 0.01)
            .polygonCapColor(d => d === hoverD ? 'rgba(0,255,255,0.3)' : 'rgba(0,255,255,0.1)');
        });
    });
  </script>
  <script src="https://unpkg.com/topojson-client@3"></script>
</body>
</html>
